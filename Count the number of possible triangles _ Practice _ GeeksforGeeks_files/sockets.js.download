if(socketConnection!=""){var allResponses=[];var socket="";function createSocketConnection(){socket=new WebSocket(socketConnection);socket.onopen=function(e){console.log("connection established");var extra={};if(pageSource=="all_discussions"){extra={userHandle:currentUser,userProfileImg:userProfileImg,dt:currentDateTime}}var final={action:"enterroom",message:wsRoom,wdb:wdb,pageSource:pageSource,uid:userId};final=Object.assign({},final,extra);socket.send(JSON.stringify(final));if(pageSource=="all_discussions"&&isAdmin!=undefined&&isAdmin==false){sendMessageToSocket("gfgTaStatus","")}};socket.onclose=function(e){console.log("connection closed");socket.send(JSON.stringify({action:"exitroom",message:wsRoom,wdb:wdb,pageSource:pageSource}));createSocketConnection()};socket.onmessage=function(e){if(e.data==""){return}var response=JSON.parse(e.data);if(pageSource=="all_discussions"){if(response.hasOwnProperty("refId")==false||allowedBatchIds.indexOf(parseInt(response.refId))!=-1||allowedBatchIds.indexOf("all")!=-1){if(response.type=="gfgTaStatus"){handleTaOnlineOffline(response)}else{allResponses.push(response)}}}else if(response.type=="submitDoubt"){if((response.subtype=="submitDoubtForBatch"||response.subtype=="submitDoubtForProblem")&&parseInt(response.id)==parseInt(wsId)){showSnackBarFn("New thread added",15e3);playNotificationSound();$("#new-doubts-added").css("display","block")}}else if(response.type=="doubtPicked"){var doubtId=response.doubtId;var id=response.id;var pickedBy=response.pickedBy;var updatepickedBy=false;var commentAuthor=response.author;if(pageSource=="thread_page"){doubtId=response.doubtId;if(doubtId==wCommentId){updatepickedBy=true}}else{if(id==wsId){updatepickedBy=true}}if(updatepickedBy){if($("[discussion='"+doubtId+"']").length>0){var pickCommentSpan=$("[discussion='"+doubtId+"']").find(".discussion-meta .pickComment").parent();if(pickCommentSpan.length>0){pickCommentSpan.find("a").remove();pickCommentSpan.addClass("wsal");pickCommentSpan.text("PickedBy: "+pickedBy)}var pickCommentSpan1=$("[discussion='"+doubtId+"']").find(".comment-meta .pickComment").parent();if(pickCommentSpan1.length>0){pickCommentSpan1.find("a").remove();pickCommentSpan1.text("PickedBy: "+pickedBy)}var pickCommentSpan2=$("[discussion='"+doubtId+"']").find(".entitle-pickup");if(pickCommentSpan2.length>0&&commentAuthor==currentUser){pickCommentSpan2.text(" [ picked ]");var commentTitle=$("[discussion='"+doubtId+"']").find(".cmt-title").html();showSnackBarFn("Thread Picked - ("+commentTitle+" )",1e4)}if(currentUser==pickedBy){$(".lockInfo").html(pickedBy+" picked comment at "+response.extraData.pickedAt);if($(".releaseComment").length==0){$('<span><a class="releaseComment">Release Lock</a></span>').insertAfter(".lockInfo")}else if($(".releaseComment").length==1){$(".releaseComment").parent().remove();$('<span><a class="releaseComment">Release Lock</a></span>').insertAfter(".lockInfo")}if(openDiscussionPage==doubtId||pageSource=="thread_page"){showSnackBarFn("Thread picked by you from other screen, Please reload the page",6e4)}}}}}else if(response.type=="typing"){var commentId=response.commentId;if(pageSource=="thread_page"&&response.user!=""){$(".styping i").text(response.user+" is typing...");$(".styping").css("display","block");setTimeout(function(){$(".styping").css("display","none")},2e3)}else{if(openDiscussionPage==commentId&&response.user!=""){$(".styping i").text(response.user+" is typing...");$(".styping").css("display","block");setTimeout(function(){$(".styping").css("display","none")},2e3)}}}else if(response.type=="releaseComment"){var doubtId=response.doubtId;var id=response.id;var updated=false;if(pageSource=="thread_page"){if(doubtId==wCommentId){updated=true;$(".lockInfo").html('<a class="pickComment singleDiscussion">Acquire Lock</a>')}}if(id==wsId){updated=true}if(updated){if($("[discussion='"+doubtId+"']").length>0){var span=$("[discussion='"+doubtId+"']").find(".discussion-meta .wsal");var span1=$("[discussion='"+doubtId+"']").find(".comment-meta .lockInfo");if(openDiscussionPage==doubtId){span.html("<a class='pickComment singleDiscussion'>Acquire Lock</a>");span1.html("<a class='pickComment singleDiscussion'>Acquire Lock</a>")}else{span.html("<a class='pickComment'>Acquire Lock</a>");span1.html("<a class='pickComment'>Acquire Lock</a>")}$(".releaseComment").hide();$("[discussion='"+doubtId+"']").find(".entitle-pickup").html("");$(".disqusDiv").hide()}}}else if(response.type=="addReply"){var commentId=response.commentId;if(pageSource=="thread_page"||openDiscussionPage==commentId){if(response.reply!=""){var reply=JSON.parse(response.reply);var actions='<div class="reply-actions pull-right text-right dropdown"><a class="dropdown-toggle" data-toggle="dropdown" href="#">';actions+='<i class="fas fa-ellipsis-v" style="color:#595959"></i></a><ul class="dropdown-menu">';actions+='<li><a class="markInappropriateReply" role="menuitem" style="cursor:pointer;">Mark as Inappropriate</a></li>';if(editDiscussionPermission){actions+='<li><a class="editReply" style="cursor:pointer;">Edit Reply</a></li>';actions+='<li><a class="deleteReply" role="menuitem" style="cursor:pointer;">Delete Reply</a></li>'}actions+="</ul></div>";var html="<div id="+reply.replyId+" class='reply-post' data-reply="+reply.replyId+">";html+="<img src="+reply.profileImgUrl+" class='reply-profile'/>";html+="<div class='reply-info'><div class='reply-user'>"+reply.repliedBy+"</div>";html+="<div class='reply-desc'>"+reply.replyText+"</div>";html+="<div class='reply-meta'><span><img src='https://media.geeksforgeeks.org/img-practice/doubt-clock-1600253506.svg'/> "+reply.repliedAt+"</span>";if(editDiscussionPermission){html+=reply.userSubmissionsLink}html+=actions+"</div></div></div>";if($("#reply-feed .reply-post").length){$("#reply-feed .reply-post:last").after(html)}else{$("#reply-feed #replies-section").append(html);$("#replies-section").css("display","block")}$("#replies-section").animate({scrollTop:1e4},"slow");$(".reply-title #counter_reply").text(parseInt($(".reply-title #counter_reply").text())+1);showSnackBarFn("New reply added..",7e3);playNotificationSound()}}}}}function sendMessageToSocket(type,message){if(type=="submitDoubt"){socket.send(JSON.stringify({action:"sendMessage",message:{type:"submitDoubt",subtype:wsSource,id:wsId,slug:wsSlug,roomId:wsRoom,refId:refId},wdb:wdb}))}else if(type=="doubtPicked"){if(pageSource=="all_discussions"){socket.send(JSON.stringify({action:"sendMessage",message:message,wdb:wdb}))}else{if(typeof refId!="undefined"){message["refId"]=refId}socket.send(JSON.stringify({action:"sendMessage",message:message,wdb:wdb}))}}else if(type=="typing"){c=currentUserName!=""?currentUserName:currentUser;socket.send(JSON.stringify({action:"sendMessage",message:{type:"typing",commentId:message["commentId"],roomId:[message["roomId"],wsRoom],user:c,ignore:"00000"},wdb:wdb}))}else if(type=="threadPageTyping"){c=currentUserName!=""?currentUserName:currentUser;var commentId=$("#discussion-thread").find(".discussion-post").attr("discussion");socket.send(JSON.stringify({action:"sendMessage",message:{type:"typing",roomId:[wsRoom,itemRoom],user:c,commentId:commentId,ignore:"00000"},wdb:wdb}))}else if(type=="releaseComment"){socket.send(JSON.stringify({action:"sendMessage",message:message,wdb:wdb}))}else if(type=="addReply"){socket.send(JSON.stringify({action:"sendMessage",message:{type:"addReply",reply:message["reply"],commentId:message["commentId"],ignore:"00000",roomId:message["roomId"]},wdb:wdb}))}else if(type=="gfgTaStatus"){socket.send(JSON.stringify({action:"taStatusOnlineOffline",message:{type:"gfgTaStatus",uid:userId,handle:currentUser,img:userProfileImg},wdb:wdb}))}}createSocketConnection()}function notifier(){if(allResponses.length>0){console.log("gfg1");console.log(allResponses);response=allResponses[0];$("#gfg-snackbar").text("");if(response.type=="submitDoubt"){playNotificationSound();var showSnackBar=true;if(response.subtype=="submitDoubtForBatch"){showSnackBarFn("New doubt added for batch - ("+response.slug+"), please check now.",15e3)}else if(response.subtype=="submitDoubtForProblem"){showSnackBarFn("New doubt added for problem - ("+response.slug+"), please check now.",15e3)}else{showSnackBar=false}if(showSnackBar){}var mode=$(".discussion-type option:selected").val();if((response.subtype=="submitDoubtForProblem"&&mode=="problems"||response.subtype=="submitDoubtForBatch"&&mode=="batch")&&parseInt(params.page)==1){var reloadPage=false;if($(".discussion-slug :selected").length==0){reloadPage=true}$(".discussion-slug :selected").each(function(i,sel){if(parseInt($(sel).val())==parseInt(response.id)){reloadPage=true}});if(reloadPage){$("#new-doubts-added").css("display","block");emptyAllResponses=1}}}else if(response.type=="doubtPicked"){playNotificationSound();var doubtId=response.doubtId;var pickedBy=response.pickedBy;var doubtTitle=response.doubtTitle;showSnackBarFn(pickedBy+" has picked the doubt - ( "+doubtTitle+" )",15e3);if($("[discussion='"+doubtId+"']").length>0){var pickCommentSpan=$("[discussion='"+doubtId+"']").find(".discussion-meta .pickComment").parent();pickCommentSpan.find("a").remove();pickCommentSpan.addClass("wsal");pickCommentSpan.text("PickedBy: "+pickedBy);var pickCommentSpan1=$("[discussion='"+doubtId+"']").find(".comment-meta .pickComment").parent();if(pickCommentSpan1.length>0){pickCommentSpan1.find("a").remove();pickCommentSpan1.text("PickedBy: "+pickedBy)}}}else if(response.type=="releaseComment"){var doubtId=response.doubtId;if($("[discussion='"+doubtId+"']").length>0){var span=$("[discussion='"+doubtId+"']").find(".discussion-meta .wsal");span.html("<a class='pickComment'>Acquire Lock</a>")}}allResponses.shift()}}function playNotificationSound(p){if($("#notification_auto").length==0){var audioDiv='<audio controls id="notification_auto" style="display:none;">';audioDiv+='<source src="'+urlHome+'/audio/gfg_whoa.mp3" type="audio/ogg">';audioDiv+='<source src="'+urlHome+'/audio/gfg_whoa.mp3" type="audio/mpeg"></audio>';$("body").append(audioDiv)}$("#notification_auto").get(0).play()}function handleTaOnlineOffline(response){if(response.type=="gfgTaStatus"){$("#no-ta").remove();if($(".ta-profile-"+response.uid).length==1){if(response.current_status=="offline"){$(".ta-profile-"+response.uid).remove()}}else if($(".ta-profile-"+response.uid).length==0&&response.current_status=="online"){var html='<div class="ta-profile ta-profile-'+response.uid+'" data-uid="'+response.uid+'" data-status="'+response.current_status+'">';html+='<span><img class="img img-responsive host-img host-img-js" src="'+response.img+'" alt="...">';html+='<span class="ta-profile-meta">'+response.handle+"</span></span><br></div>";$("#ta-onf-list").append(html)}if($.trim($("#ta-onf-list").html())==""){$("#ta-onf-list").html('<span id="no-ta">No Ta available</span>')}}}function showSnackBarFn(msg,time=7e3,showSnackBar=0){if(showSnackBar==1||!("Notification"in window)){$("#gfg-snackbar").text("");$("#gfg-snackbar").text(msg);$("#gfg-snackbar").addClass("show");setTimeout(function(){$("#gfg-snackbar").removeClass("show")},time)}else{notifyMe(msg)}}function notifyMe(msg){if($("handleNotificationBtn").length==0){$("body").append('<button id="handleNotificationBtn" style="display: none;" data-msg=""></button>')}$("#handleNotificationBtn").data("msg",msg);$("#handleNotificationBtn").click()}$("body").on("click","#handleNotificationBtn",function(){var msg=$("#handleNotificationBtn").data("msg");if(Notification.permission==="granted"){createNotification(msg)}else if(Notification.permission!=="denied"){Notification.requestPermission(function(permission){if(!("permission"in Notification)){Notification.permission=permission}if(permission==="granted"){createNotification(msg)}else{showSnackBarFn(msg,7e3,1)}})}});function createNotification(msg){var options={body:msg,icon:"icon.jpg",dir:"ltr"};var notification=new Notification("New Message",options)}setInterval(function(){notifier()},1e4);